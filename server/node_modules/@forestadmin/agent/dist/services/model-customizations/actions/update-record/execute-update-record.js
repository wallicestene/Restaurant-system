"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const datasource_toolkit_1 = require("@forestadmin/datasource-toolkit");
const genericErrorMessage = actionName => `The no-code action <strong>${actionName}</strong> cannot be triggered due to a` +
    ' misconfiguration. Please contact your administrator.';
async function executeUpdateRecord(action, context) {
    try {
        const { configuration: { configuration: { fields: fieldsToUpdate }, }, } = action;
        const fields = fieldsToUpdate.reduce((fieldsAccumulator, fieldToUpdate) => {
            return { ...fieldsAccumulator, [fieldToUpdate.fieldName]: fieldToUpdate.value };
        }, {});
        await context.collection.update(context.filter, fields);
    }
    catch (error) {
        if (error instanceof datasource_toolkit_1.BusinessError) {
            return {
                type: 'Error',
                message: `${genericErrorMessage(action.name)}<br/>(${error.name}: ${error.message})`,
            };
        }
        return {
            type: 'Error',
            message: genericErrorMessage(action.name),
        };
    }
}
exports.default = executeUpdateRecord;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhlY3V0ZS11cGRhdGUtcmVjb3JkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL3NlcnZpY2VzL21vZGVsLWN1c3RvbWl6YXRpb25zL2FjdGlvbnMvdXBkYXRlLXJlY29yZC9leGVjdXRlLXVwZGF0ZS1yZWNvcmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSx3RUFBOEU7QUFHOUUsTUFBTSxtQkFBbUIsR0FBRyxVQUFVLENBQUMsRUFBRSxDQUN2Qyw4QkFBOEIsVUFBVSx3Q0FBd0M7SUFDaEYsdURBQXVELENBQUM7QUFFM0MsS0FBSyxVQUFVLG1CQUFtQixDQUMvQyxNQUEwQixFQUMxQixPQUF5QjtJQUV6QixJQUFJO1FBQ0YsTUFBTSxFQUNKLGFBQWEsRUFBRSxFQUNiLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsR0FDMUMsR0FDRixHQUFHLE1BQU0sQ0FBQztRQUVYLE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxhQUFhLEVBQUUsRUFBRTtZQUN4RSxPQUFPLEVBQUUsR0FBRyxpQkFBaUIsRUFBRSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsRUFBRSxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbEYsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRVAsTUFBTSxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQ3pEO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxJQUFJLEtBQUssWUFBWSxrQ0FBYSxFQUFFO1lBQ2xDLE9BQU87Z0JBQ0wsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsT0FBTyxFQUFFLEdBQUcsbUJBQW1CLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEtBQUssQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLE9BQU8sR0FBRzthQUNyRixDQUFDO1NBQ0g7UUFFRCxPQUFPO1lBQ0wsSUFBSSxFQUFFLE9BQU87WUFDYixPQUFPLEVBQUUsbUJBQW1CLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztTQUMxQyxDQUFDO0tBQ0g7QUFDSCxDQUFDO0FBN0JELHNDQTZCQyJ9