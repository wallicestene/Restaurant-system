"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const datasource_toolkit_1 = require("@forestadmin/datasource-toolkit");
const context_1 = __importDefault(require("./context"));
const result_builder_1 = __importDefault(require("./result-builder"));
class ChartCollectionDecorator extends datasource_toolkit_1.CollectionDecorator {
    constructor() {
        super(...arguments);
        this.charts = {};
    }
    addChart(name, definition) {
        if (this.schema.charts.includes(name)) {
            throw new Error(`Chart '${name}' already exists.`);
        }
        this.charts[name] = definition;
        this.markSchemaAsDirty();
    }
    async renderChart(caller, name, recordId) {
        if (this.charts[name]) {
            const context = new context_1.default(this, caller, recordId);
            const resultBuilder = new result_builder_1.default();
            return this.charts[name](context, resultBuilder);
        }
        return this.childCollection.renderChart(caller, name, recordId);
    }
    refineSchema(subSchema) {
        return {
            ...subSchema,
            charts: [...subSchema.charts, ...Object.keys(this.charts)],
        };
    }
}
exports.default = ChartCollectionDecorator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kZWNvcmF0b3JzL2NoYXJ0L2NvbGxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSx3RUFNeUM7QUFFekMsd0RBQStDO0FBQy9DLHNFQUE2QztBQUc3QyxNQUFxQix3QkFBeUIsU0FBUSx3Q0FBbUI7SUFBekU7O1FBQ1UsV0FBTSxHQUE4QyxFQUFFLENBQUM7SUE0QmpFLENBQUM7SUExQkMsUUFBUSxDQUFDLElBQVksRUFBRSxVQUFxQztRQUMxRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNyQyxNQUFNLElBQUksS0FBSyxDQUFDLFVBQVUsSUFBSSxtQkFBbUIsQ0FBQyxDQUFDO1NBQ3BEO1FBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDL0IsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVRLEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBYyxFQUFFLElBQVksRUFBRSxRQUFxQjtRQUM1RSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDckIsTUFBTSxPQUFPLEdBQUcsSUFBSSxpQkFBc0IsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ25FLE1BQU0sYUFBYSxHQUFHLElBQUksd0JBQWEsRUFBRSxDQUFDO1lBRTFDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUM7U0FDbEQ7UUFFRCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVrQixZQUFZLENBQUMsU0FBMkI7UUFDekQsT0FBTztZQUNMLEdBQUcsU0FBUztZQUNaLE1BQU0sRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQzNELENBQUM7SUFDSixDQUFDO0NBQ0Y7QUE3QkQsMkNBNkJDIn0=