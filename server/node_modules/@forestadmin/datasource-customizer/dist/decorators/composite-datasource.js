"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class CompositeDatasource {
    constructor() {
        this.dataSources = [];
    }
    get schema() {
        return { charts: this.dataSources.flatMap(dataSource => dataSource.schema.charts) };
    }
    get collections() {
        return this.dataSources.flatMap(dataSource => dataSource.collections);
    }
    getCollection(name) {
        for (const collection of this.dataSources) {
            try {
                return collection.getCollection(name);
            }
            catch (error) {
                // Ignore
            }
        }
        throw new Error(`Collection '${name}' not found. List of available collections: ${this.collections
            .map(c => c.name)
            .sort()
            .join(', ')}`);
    }
    addDataSource(dataSource) {
        for (const collection of dataSource.collections) {
            if (this.collections.some(c => c.name === collection.name)) {
                throw new Error(`Collection '${collection.name}' already exists`);
            }
        }
        for (const chart of dataSource.schema.charts) {
            if (this.schema.charts.includes(chart)) {
                throw new Error(`Chart '${chart}' is already defined in datasource.`);
            }
        }
        this.dataSources.push(dataSource);
    }
    async renderChart(caller, name) {
        for (const dataSource of this.dataSources) {
            if (dataSource.schema.charts.includes(name)) {
                return dataSource.renderChart(caller, name);
            }
        }
        throw new Error(`Chart '${name}' is not defined in the dataSource.`);
    }
}
exports.default = CompositeDatasource;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9zaXRlLWRhdGFzb3VyY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVjb3JhdG9ycy9jb21wb3NpdGUtZGF0YXNvdXJjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQVFBLE1BQXFCLG1CQUFtQjtJQUF4QztRQUdVLGdCQUFXLEdBQWlCLEVBQUUsQ0FBQztJQW9EekMsQ0FBQztJQWxEQyxJQUFJLE1BQU07UUFDUixPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO0lBQ3RGLENBQUM7SUFFRCxJQUFJLFdBQVc7UUFDYixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBUSxDQUFDO0lBQy9FLENBQUM7SUFFRCxhQUFhLENBQUMsSUFBWTtRQUN4QixLQUFLLE1BQU0sVUFBVSxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDekMsSUFBSTtnQkFDRixPQUFPLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFNLENBQUM7YUFDNUM7WUFBQyxPQUFPLEtBQUssRUFBRTtnQkFDZCxTQUFTO2FBQ1Y7U0FDRjtRQUVELE1BQU0sSUFBSSxLQUFLLENBQ2IsZUFBZSxJQUFJLCtDQUErQyxJQUFJLENBQUMsV0FBVzthQUMvRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO2FBQ2hCLElBQUksRUFBRTthQUNOLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUNoQixDQUFDO0lBQ0osQ0FBQztJQUVELGFBQWEsQ0FBQyxVQUFzQjtRQUNsQyxLQUFLLE1BQU0sVUFBVSxJQUFJLFVBQVUsQ0FBQyxXQUFXLEVBQUU7WUFDL0MsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUMxRCxNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsVUFBVSxDQUFDLElBQUksa0JBQWtCLENBQUMsQ0FBQzthQUNuRTtTQUNGO1FBRUQsS0FBSyxNQUFNLEtBQUssSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtZQUM1QyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDdEMsTUFBTSxJQUFJLEtBQUssQ0FBQyxVQUFVLEtBQUsscUNBQXFDLENBQUMsQ0FBQzthQUN2RTtTQUNGO1FBRUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBYyxFQUFFLElBQVk7UUFDNUMsS0FBSyxNQUFNLFVBQVUsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3pDLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUMzQyxPQUFPLFVBQVUsQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO2FBQzdDO1NBQ0Y7UUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLFVBQVUsSUFBSSxxQ0FBcUMsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7Q0FDRjtBQXZERCxzQ0F1REMifQ==